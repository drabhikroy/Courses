---
title: "Distributions and Central Tendency"
subtitle: "EDP 613"
author: "Week 3"
output: 
 xaringan::moon_reader:
   css: xaringan-themer.css
   nature:
     ratio: 16:9
     highlightStyle: github
     highlightLines: true
     countIncrementalSlides: false
     navigation:
         scroll: false
---

<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  }
</script>

<style>
section {
    display: flex;
    display: -webkit-flex;
}

section p {
    margin: auto;
}

.hljs-github .hljs {
    background: transparent;
    color: #b2dfdb;
}

.hljs-github .hljs-keyword {
    color: #64b5f6;
}

.hljs-github .hljs-literal {
    color: #64b5f6;
}

.hljs-github .hljs-number {
    color: #64b5f6;
}

.hljs-github .hljs-string {
    color: #b7b3ef;
}

section {
    height: 600px;
    width: 60%;
    margin: auto;
    border-radius: 20px;
    background-color: #212121;
}

section p {
    text-align: center;
    font-size: 30px;
    background-color: #212121;
    border-radius: 20px;
    font-family: Roboto Condensed;
    font-style: bold;
    padding: 15px;
    color: #bff4ee;
}

#center {
text-align: center;
}

.center p {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.center2 {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

</style>

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(here)
```

```{r echo = FALSE, purl = FALSE}
xaringanthemer::style_duo(
  primary_color = "#212121",
  secondary_color = "#bff4ee",
  code_inline_background_color = "transparent",
  code_inline_color = "#b2dfdb",
  code_highlight_color = "#db6464",
  table_row_border_color = "#212121",
  table_row_even_background_color = "#212121",
  footnote_font_size = "0.6em",
  header_font_google = xaringanthemer::google_font("Roboto Condensed", "700"),
  text_font_google   = xaringanthemer::google_font("Roboto Condensed", "400")
)

xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))

xaringanExtra::use_logo(
  image_url = here::here("static", "img", "course_hex_alpha.png"),
  link_url = "https://edp613.asocialdatascientist.com",
  position = xaringanExtra::css_position(top = "1em", right = "1em")
  )
```

# Prepping a New R Script

1. Open up a blank R script using the menu path **File > New File > R Script**.

--

2. Save this script as `whatever.R` (replacing the term `whatever`) in your R folder. Remember to note where the file is!

--

3. After you have saved this file as `whatever.R`, go to the menu and select **Session > Set Working Directory > To Source File Location**.

---

# Getting ready for this session

>- Get the file `2012 Voter Fraud.csv` and save it in the same location as this script. Similarly make sure you also have `2012_Voter_Fraud_Codebook.pdf`. This document provides information about every variable in this data set. If you pursue any data driven research, a codebook like this is essential for data sets!

>- Install the packages `car` and `descr`. Remember you can download it using **Tools > Install Packages** and typing in the name. Please make sure the **Install Dependencies** option has a checkmark beside of it. The install may take a minute.

<center>
<img src="install-packages.png" width="343" height="252" alt="Italian Trulli">
</center>

---

>- Load up the packages along with `tidyverse`.

```{r echo = TRUE, eval = TRUE, message=FALSE}
library(tidyverse)
library(car)
library(descr)
``` 

---

# Frequency distributions

Often the first thing we do when we encounter a new variable is to look at the variable's frequency distribution which in a nutshell tells us how many observations there are at different values of a variable. If we did not have a computer, we could look at data sheet and count them up by hand (depends on how much you LOVE counting data points). 

But by using R (or any other data analysis package), we look at frequency distributions by using a frequency table. This table provides a summary of a variable's values in to a condensed and simplified presentation. We can use frequency tables to look at any variable from any data set. 

---

## Loading up local data

To explore this, let's load the 2012 voter fraud file first and assign it to a variable. We can do this using the `read_csv()` command from the `readr` package within `tidyverse`.

```{r echo = TRUE, eval = FALSE}
voter_fraud <- read_csv("2012_Voter_Fraud.csv")
```

```{r echo = FALSE, eval = TRUE, purl=FALSE}
voter_fraud <- read_csv(here::here("static", "slides", "Week 3", "2012_Voter_Fraud.csv"))
```

---

## Side note

R itself uses `read.csv` which can be a royal pain if you don't know what you're doing. Its strongly advised that you stick with the tidy way of loading data.

Remember:

>- `read_csv` with a `_` is tidy

>- `read.csv` with a `.` is messy

---

## Getting an idea of the data

You can always view the data set by using `View(voter_fraud)` but in this instance, let's take a look at the first six lines of the data set. Remember we can do this by using

```{r echo = TRUE, eval = TRUE}
head(voter_fraud)
```

---

## Alternative

... or we can do 

```{r echo = TRUE, eval = TRUE}
voter_fraud[1:6,]
```

---

## Just the (column) names please

We can only take a look at the column names by doing

```{r echo = TRUE, eval = TRUE}
names(voter_fraud)
```

---

Let's look at a frequency table for the variable `battleground`, which is a dummy variable for whether a state was a battleground or not during the 2012 US presidential election. Here

>- `1 = 'battleground state'` and

>- `0 = 'not battleground state'`

--

There a number of ways of displaying tabular information , but in this case we'll just use the built-in R function `table`

```{r echo = TRUE, eval = TRUE}
table(voter_fraud$battleground)
```

>- The first row of the output tells us the values (remember what `1` and `0` stand for - these are categorical variables even though they are represented numerically).

>- The second row gives is the number of observations for each value. So we have 
  - 42 states battleground states and 
  - 8 non battleground states. 

---

Well that is great but what if we have a lot of values? For example, let's look at the variable `total` which gives us data for the number of articles by newspaper.

```{r echo = TRUE, eval = TRUE}
table(voter_fraud$total)
```
 
 
---

## Using the `freq` command (1/2)

```{r echo = FALSE, eval = TRUE}
table(voter_fraud$total)
```

That seems like a lot. Let's plot them on a bar chart using the `freq` command from the `descr` package.

---

```{r echo = TRUE, eval = TRUE, fig.width=7.8, fig.height=3.9, fig.align="center"}
freq(voter_fraud$total, plot = TRUE)
```

---

## Using the `freq` command (2/2)

... and you get something like this

<img src="freq-secondary-output.png" width="239" height="460" alt="Install Packages Window">

---

While you could present the results by going through each newspaper by stating 1 newspaper had zero articles, 1 newspaper had one article, 2 newspapers had two articles and so on. 

This is time consuming and doesnâ€™t really help in summarizing the information. Do we really need to display each individual newspaper and their counts? Seems a bit messy. One way to make the data easier to understand is to use ranges.

---

We need to add a column to our data set and give it values for the ranges. We can simply add a column using the `$`. Because we want to add ranges, let's just call the new column by that term.

> `voter_fraud$ranges`

Then to add the actual ranges , we can use the `recode` command from the `descr` package.

```{r echo = TRUE, eval = TRUE}
voter_fraud$ranges <- recode(voter_fraud$total, 
                                "0:9 = '0 - 9 articles';
                                10:19 ='10 - 19 articles';
                                20:29 = '20 - 29 articles';
                                30:39 = '30 - 39 articles';
                                40:49 = '40 - 49 articles'")
```

What do you think is happening here? Think about it for a minute before moving on. 

The thing about R as opposed to the click and run nature of most softwares (e.g. SAS, SPSS, MiniTab, etc.) is that you know exactly what command is being run and what its doing with your data. Because of this, you are more likely to understand what is going on and less likely to go through the motions to get a solution.

---

Even if you can't figure it out...that's OK! Let's run the `table` command again. Maybe that will help:

```{r echo = TRUE, eval = TRUE}
table(voter_fraud$ranges)
```

That is much better! Now did you figure it out? Here let's look at the chunk again:

```{r echo = TRUE, eval = FALSE}
voter_fraud$ranges <- recode(voter_fraud$total, 
                                "0:9 = '0 - 9 articles';
                                10:19 ='10 - 19 articles';
                                20:29 = '20 - 29 articles';
                                30:39 = '30 - 39 articles';
                                40:49 = '40 - 49 articles'")
```

We actually did two things:

>- Inside the parenthesis: We made up our own ranges using all of the counts (e.g `0:9`) and told R to call them something else (e.g `0 - 9 articles`). 

>- Outside the parenthesis: We used the `recode` command to tell R to count everything in each of those ranges and to give us the total. 

Try playing with the range to see if you can group the articles more efficiently. 

---

Now let's plot the bar chart again but in this case, we'll be using our new column `ranges`.


```{r echo = TRUE, eval = TRUE, fig.width=8, fig.height=4}
freq(voter_fraud$ranges, plot = TRUE)
```

That's much better!

---


There's actually an even easier way to do this totally in the `tidyverse` family but we'll get to that later in the term.

Right now your job is just to get familiar with how logic is used in R. 

---

# Measures of Central Tendency

To take a look at how we assess the mean, median, and mode, let's use our original data set and first look at the `total` column which has the raw data counts. 

```{r echo = TRUE, eval = TRUE, fig.width=10, fig.height=6}
head(voter_fraud$total)
```

---

For the mean, we use
```{r echo = TRUE, eval = TRUE, fig.width=10, fig.height=6}
mean(voter_fraud$total)
```


---

For the median, we use
```{r echo = TRUE, eval = TRUE, fig.width=10, fig.height=6}
median(voter_fraud$total)
```

---

For the mode, we use
```{r echo = TRUE, eval = TRUE, fig.width=10, fig.height=6}
mode(voter_fraud$total)
```

`mode` still doesn't work!

---

For various programming reasons that are not worth discussing at this time, R does not have a standard in-built function to calculate the mode. Try running   

```{r echo = TRUE, eval = FALSE}
?mode
```

The `?` symbol prior to any command will give you information about that function provided you have that package loaded. Yes its not clearly not written in plain English, but it does tell you that the `mode` command means something else in R. 

OK let's get back to the mode we need. To get the mode, we actually have to tell R how to go about calculating it. Below is a function that will help. In order for R to recognize it, you have to run the following sequence before using the command.

```{r echo = TRUE, eval = TRUE}
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Notice that 'Mode' is capitalized so that R won't confuse it
# with its internal command 'mode'.
```

Keep that chunk in a file somewhere. You don't have to know what it means or how to construct it or any of that. This is not a programming class. As long as you run that chunk before trying to find a mode, you'll be fine.

```{r echo = TRUE, eval = TRUE}
Mode(voter_fraud$total)
```

---

# On Your Own

This is your chance to get some practice in and to ask questions. You won't get the opportunity to get help during quizzes and exams so take advantage now!

Open up a new script and load up the `Box Office.csv` data set in R. This set was scraped from Rotten Tomatoes prior to Avengers: Endgame becoming the highest grossing movie of all time.

Now try answering the following questions using R:

1. What is the average number of positive reviews for the top five movies?

2. What are the average number of negative reviews for the bottom five movies?

3. How were movies released over the years? Provide counts and a visualization.

4. Which measure of central tendency is the best to describe the average number of movies over the years? 

5. Which year has the most number of ranked movies?  

I'll post the solutions next week!

---

## That's it for today!
