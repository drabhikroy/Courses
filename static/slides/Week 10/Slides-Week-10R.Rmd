---
title: "The Not so Tiny t-test"
linktitle: "Week 10: The Not so Tiny t-test"
author: "Week 10"
output: 
 xaringan::moon_reader:
   css: xaringan-themer.css
   nature:
     ratio: 16:9
     highlightStyle: github
     highlightLines: true
     countIncrementalSlides: false
     navigation:
         scroll: false
---

```{r echo=FALSE}
textcolor <- 
  function(text, color){
  sprintf("<span style='color: %s;'>%s</span>", color, text)
    }
```

<script>
  function resizeIframe(obj) {
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  }
</script>

<style>
section {
    display: flex;
    display: -webkit-flex;
}

section p {
    margin: auto;
}

.hljs-github .hljs {
    background: transparent;
    color: #b2dfdb;
}

.hljs-github .hljs-keyword {
    color: #64b5f6;
}

.hljs-github .hljs-literal {
    color: #64b5f6;
}

.hljs-github .hljs-number {
    color: #64b5f6;
}

.hljs-github .hljs-string {
    color: #b7b3ef;
}

section {
    height: 600px;
    width: 60%;
    margin: auto;
    border-radius: 20px;
    background-color: #212121;
}

section p {
    text-align: center;
    font-size: 30px;
    background-color: #212121;
    border-radius: 20px;
    font-family: Roboto Condensed;
    font-style: bold;
    padding: 15px;
    color: #bff4ee;
}

#center {
text-align: center;
}

.center p {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.center2 {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

.custom-inline {
  color: #bff4ee;
}

</style>

```{r setup, include=FALSE, purl=FALSE}
library(tidyverse)
library(fontawesome)
library(knitr)
library(kableExtra)
library(patchwork)
library(flipbookr)
library(ggmap)
```

```{r echo = FALSE, purl=FALSE}
xaringanthemer::style_duo(
  primary_color = "#212121",
  secondary_color = "#bff4ee",
  code_inline_background_color = "transparent",
  code_inline_color = "#b2dfdb",
  code_highlight_color = "#db6464",
  table_row_border_color = "#212121",
  table_row_even_background_color = "#212121",
  footnote_font_size = "0.6em",
  header_font_google = xaringanthemer::google_font("Roboto Condensed", "700"),
  text_font_google   = xaringanthemer::google_font("Roboto Condensed", "400")
)

xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))

xaringanExtra::use_logo(
  image_url = here::here("static", "img", "course_hex_alpha.png"),
  link_url = "https://edp613.asocialdatascientist.com",
  position = xaringanExtra::css_position(top = "1em", right = "1em")
  )
```

# Packages needed and a Note about Icons

Please load up the following packages. Remember to first install the ones you don't have.
```{r echo = FALSE, eval = TRUE, message=FALSE}
library(tidyverse)
library(mosaic)
library(ggplot2movies)
``` 

```{r echo = FALSE, eval = TRUE, message=FALSE}
suppressMessages(library(tidyverse))
suppressMessages(library(mosaic))
suppressMessages(library(ggplot2movies))
``` 
<br>
<br>
You may come across the following icons. The table below lists what each means.
```{r eval = TRUE, echo = FALSE, purl=FALSE}
forward <- as.character(fontawesome::fa("forward", fill = "
#4682b4"))

stop <- as.character(fontawesome::fa("stop", fill = "#ff6347"))

link <- as.character(fontawesome::fa("link", fill = "#5cb85c"))

bookmark <- as.character(fontawesome::fa("bookmark", fill = "#faffbd"))


icon_desc <- tibble(
  
  Icon = c(forward,
           stop, 
           link,
           bookmark),
  
  Description = c("Indicates that an example continues on the following slide.",
                  "Indicates that a section using common syntax has ended.",
                  "Indicates that there is an active hyperlink on the slide.",
                  "Indicates that a section covering a concept has ended.")
  
)
```

```{r message=FALSE, warning=FALSE, eval = TRUE, echo = FALSE, purl=FALSE}
kable(icon_desc, 
      escape = FALSE,
      align = 'cl') %>%
  kable_styling(full_width = FALSE) %>%
  column_spec(1, width = "10em") %>%
  column_spec(2, width = "40em") %>%
  row_spec(0, background = "transparent") %>%
  row_spec(1, background = "#transparent") %>%
  row_spec(2, background = "#transparent") %>%
  row_spec(3, background = "#transparent") %>%
  row_spec(4, background = "#transparent") 
```

---

# Comparing the Means Between Groups of Things

The $t$-test is:

--

- One of the most common tests in statistics

--

- Used to determine whether the means of two groups are equal

---

# Ideas

--

> **One-sample *t*-tests**: Compare the sample mean with a known value, when the variance of the population is unknown

--

> **Two-sample *t*-tests**: Compare the means of two groups under the assumption that both samples are random, independent, and normally distributed with unknown but equal variances

--

> **Paired *t*-tests**: Compare the means of two sets of paired samples, taken from two populations with unknown variance

---

## Packages

Please load up the following packages

```{r echo = TRUE, eval = TRUE}
library(tidyverse)
library(patchwork)
```

---

# The Base R `t.test` command

```{r ttest_definition, eval=FALSE}
t.test(x, y = NULL, 
       alternative = c("two.sided", "less", "greater"), 
       mu = 0, 
       paired = FALSE, 
       var.equal = FALSE, 
       conf.level = 0.95)
```

```{r echo=FALSE}

tibble(

option = c("x", "y", "mu", "alternative", "paired", "var.equal", "conf.level"),

what <- c("a numeric vector from a data set",
          "an optional numeric vector from a data set",
          "a number indicating the true value of the mean",
          "preference on type of test you wish to run",
          "preference on whether you wish to perform a paired <i>t</i>-test",
          "indicates whether or not to assume equal variances when performing a two-sample  <i>t</i>-test",
          "the confidence level of the reported confidence interval")

) %>%
  kbl(col.names = c("Option", "Function"), 
      "html", 
      escape = FALSE,
      align = 'cl') %>%
  kable_styling(full_width = FALSE) %>%
  column_spec(1, width = "10em", 
              color = "#b2dfdb", 
              monospace = TRUE) %>%
  column_spec(2, width = "40em")

```

---

### Notes

- The `var.equals` argument has a default setting of `r textcolor(FALSE, "#64b5f6")` indicating unequal variances and applies the Welsch approximation to the degrees of freedom. 
  
  - If you wish to have equal variances, this can be done by changing the setting to `r textcolor(TRUE, "#64b5f6")`
  
--

- The `conf.level` argument is set to 95%, or where $\alpha = 0.05$. 

  - The confidence interval is determined by
      - $\mu$ for the one-sample *t*-test 
    
      - $\mu_1-\mu_2$ for the two-sample *t*-test. 
      
---

### Be Aware!

> The `wilcox.test` function provides the same basic functionality and arguments

--

<br>
<br>
> However it is used when we ***do not want to assume the data to follow a normal distribution***

--

<br>
<br>
> We're assuming normality

--

<br>
<br>
> So please ignore it for now!

---

# Assumptions

--

.pull-left[**Random sampling**] .pull-right[*Data is derived from random sampling*]

--

<br>
<br>
<br>
<br> 
.pull-left[**Independent observations**] .pull-right[*Observations are independent from one another*]

--

<br>
<br>
<br>
<br> 
.pull-left[**Normality**] .pull-right[*Observations are from a normally distributed population*]

--

<br>
<br>
<br>
<br> 
.pull-left[**Homogeneity**] .pull-right[*If more than one population is sampled from, then the populations have equal variances (aka **homogeneity of variances**)*]

---

---

## One- or Two-sample *t*-tests

--

If `y` is

– excluded, `t.test` will run as a one-sample *t*-test

– included, `t.test` will run as a two-sample *t*-test

- default `t.test` command will run as a two-sided *t*-test

- you can run a one-sided *t*-test by changing the `alternative` option to `greater` or `less`

---

#### Example


`t.test(x, alternative = "greater", mu = 47)` performs a one-sample *t*-test on the data contained in `x` where 

$$H_0: \mu = 47$$
  
$$H_1: \mu > 47$$
      
---

## Example

```{r}
midwest %>%
  head()
```

.footnote[Please use `?midwest` for more details on the variables]

---

### Purpose

We want to compare the differences between the average percent of college educated adults in Ohio versus Michigan

```{r sw1, include = FALSE}
midwest %>%
  filter(state == "OH" | state == "MI") %>%
  select(state, percollege)
```
`r chunk_reveal(chunk_name = "sw1", color = c("white", "white", "white"), width = c(100, 100), float = "top")`

---

```{r}
ohio_mi <- 
  midwest %>%
  filter(state == "OH" | state == "MI") %>%
  select(state, percollege)
```

---

### Descriptives

--

.pull-left[
```{r echo=FALSE, warning=FALSE, fig.width=1,fig.height=1, fig.align='center', dev.args=list(bg="transparent")}
map_data("state") %>%
  as_tibble() %>%
  filter(region == "ohio") %>%
ggplot(aes(x = long, 
           y = lat, 
           group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "#ffffff", 
               fill = "#BB0000",
               show.legend = FALSE,
              size = 0.15) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = "transparent", 
                                       color = NA))
```

```{r}
ohio_mi %>% 
  filter(state == "OH") %>%
  summary()
```
]

--

.pull-right[
```{r echo=FALSE, warning=FALSE, fig.width=1.3,fig.height=1.3, fig.align='center', dev.args=list(bg="transparent")}
map_data("state") %>%
  as_tibble() %>%
  filter(region == "michigan") %>%
ggplot(aes(x = long, 
           y = lat, 
           group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "#ffffff", 
               fill = "#00274C",
               show.legend = FALSE,
              size = 0.15) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_rect(fill = "transparent"),
        plot.background = element_rect(fill = "transparent", 
                                       color = NA))
```

```{r}
ohio_mi %>% 
  filter(state == "MI") %>%
  summary()
```
]

--

<br>
<br>
<center>
Ohio appears to have slightly less college educated adults than Michigan but let's see if that's actually true
</center>

---

### Boxplot

```{r sw2, include = FALSE}
ggplot(ohio_mi, aes(x = state, 
                    y = percollege, 
                    fill = state)) +
        geom_boxplot(alpha = 0.7,
                     outlier.size = 2.5) +
        scale_fill_manual(values = c("#00274C", 
                                     "#BB0000")) +
        theme_minimal() +
        theme(panel.grid.major.x = element_blank(),
              panel.grid.minor.x = element_blank())
```

`r chunk_reveal(chunk_name = "sw2", color = c("white", "white", "white"), width = c(110, 90))`

---

### Shifting Skewness

```{r sw3, include = FALSE}
ggplot(ohio_mi, aes(x = percollege)) +
        geom_histogram(aes(fill = ..count..),
                       bins = 20) +
        scale_fill_viridis_c("Frequency") +
        facet_wrap(. ~ state) +
        theme_minimal() +
        scale_x_log10()
```

`r chunk_reveal(chunk_name = "sw3", color = c("white", "white", "white"), width = c(110, 90))`

---

### More Shifting Skewness

```{r sw4, include = FALSE}
ggplot(ohio_mi, aes(x = percollege)) +
        geom_histogram(aes(fill = ..count..),
                       bins = 20) +
        scale_fill_viridis_c("Frequency") +
        facet_wrap(. ~ state, ncol = 1) +
        theme_minimal() +
        scale_x_log10()
```
`r chunk_reveal(chunk_name = "sw4", color = c("white", "white", "white"), width = c(110, 90))`

---

--

.pull-left[
```{r}
regularplot <- 
  ggplot(ohio_mi, aes(x = percollege)) +
  geom_histogram(aes(fill = ..count..),
                 bins = 20) +
  scale_fill_viridis_c("Frequency") +
  facet_wrap(~ state, ncol = 1) +
  theme_minimal() +
  ggtitle("Regular")
```
]

--

.pull-right[
```{r}
scaledplot <- 
  ggplot(ohio_mi, aes(x = percollege)) +
  geom_histogram(aes(fill = ..count..),
                 bins = 20) +
  scale_fill_viridis_c("Frequency") +
  facet_wrap(~ state, ncol = 1) + 
  theme_minimal() +
  ggtitle("Scaled") +
  scale_x_log10() # this line was added
```
]

---

```{r fig.align='center', fig.width=14}
regularplot + scaledplot
```

---

### Testing as is

```{r}
t.test(percollege ~ state, data = ohio_mi)
```

--

<br>
> Results show a *p*-value < .01 so **there is a statistical difference between the two means**

--

<br>
> This supports the alternative hypothesis that there is a difference between the average percent of college educated adults in Ohio versus Michigan

---

### Testing using a `log` function

```{r}
t.test(log(percollege) ~ state, data = ohio_mi)
```

--

<br>
> Results show a *p*-value < .01 so **there is a statistical difference between the two means**

--

<br>
> So **there is a statistical difference between the two means**

---

## Paired-samples *t*-test 

--

Same `t.test` command as in the previous sections but just change your option to `paired =` `r textcolor(TRUE, "#64b5f6")`

```{r ttest_paired, eval=FALSE}
t.test(x, y = NULL, 
       alternative = c("two.sided", "less", "greater"), 
       mu = 0, 
       paired = TRUE, 
       var.equal = FALSE, 
       conf.level = 0.95)
```

---

## Example

```{r}
sleep %>%
  head()
```

.footnote[Please use `?sleep` for more details on the variables]

---

## Purpose

We are assessing if there is a statistically significant effect of a particular drug on sleep (increase in hours of sleep compared to control) for 10 patients

```{r sw5, include = FALSE}
sleep %>%
  select(-ID)
```
`r chunk_reveal(chunk_name = "sw5", color = c("white", "white", "white"), width = c(100, 100), float = "top")`

---

## Descriptives

```{r}
sleep %>% 
  summary()
```


---

## Boxplot

--

.pull-left[
```{r fig.align='center', eval=FALSE}
sleep %>%
  ggplot(aes(group, extra, fill = group)) +
  geom_boxplot(alpha = 0.8) +
  scale_fill_manual(
    values = c("#428bca", "#d9534f")
    ) +
  theme_minimal() +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank()
    )
```
]

--

.pull-right[
```{r fig.align='center', out.width="68%", echo=FALSE}
ggplot(sleep,
       aes(group, extra, fill = group)) +
        geom_boxplot(alpha = 0.8) +
        scale_fill_manual(
          values = c("#8dbadd", "#1b75bb")
          ) +
        theme_minimal()  +
        theme(
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank()
              )
```
]

--

<br>
<br>
Asessing if there is a statistically significant effect of a particular drug on sleep (increase in hours of sleep compared to control) for 10 patients

---

### Testing

We want to see if the mean values for the extra variable differs between group 1 and group 2

```{r}
t.test(extra ~ group, data = sleep, paired = TRUE)
```

--

<br>
> Results show a *p*-value < .01 so **there is a statistical difference between the two means**

--

<br>
> This supports the alternative hypothesis that suggesting that the drug increases sleep on average by 1.58 hours

---

## Thats it!
